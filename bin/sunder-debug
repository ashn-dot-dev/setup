#!/bin/sh

usage() {
cat <<EOF
Usage: $(basename $0) FILE [TMPC]
Debug the Sunder program FILE generated using sunder-compile invoked with the
flags -g and -k and with SUNDER_BACKEND=C.

Examples:
  $(basename $0) myprogram
  $(basename $0) myprogram /path/to/myprogram.tmp.c
Options:
  -h, --help    Print this help message and exit.
EOF
}

for _ in "$@"; do
case "$1" in
    -h|--help)
        usage
        exit 0
        ;;
    *)
        ;;
esac
done

if [ "$#" -eq 0 -o "$#" -gt 2 ]; then
    usage
    exit 1
fi

FILE="${1}"
TMPC="${2}"
if [ -z "${TMPC}" ]; then
    TMPC="${FILE}.tmp.c"
fi

gdb -q --tui --eval-command "set substitute-path <stdin> ${TMPC}" "$FILE"
